<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Facial ID Edu - REDEEMERS PRIVATE SECONDARY School</title>

  <!-- Tailwind CSS with Custom Config -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#4B2067',    // Changed from green to dark purple
            secondary: '#f4f4f4',
            dark: '#1a1a1a',
          },
          animation: {
            fade: 'fadeIn 2s ease-in-out',
            bounce: 'bounce 2s infinite'
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: 0, transform: 'translateY(10px)' },
              '100%': { opacity: 1, transform: 'translateY(0)' }
            }
          }
        }
      }
    }
  </script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/face-api.js"></script>

  <!-- Firebase & App Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // --- Firebase Configuration ---
    const firebaseConfig = {
      apiKey: "AIzaSyBNe53HEVyEIwFDtgL1p3PU5tLg121AUkE",
      authDomain: "ict-comp.firebaseapp.com",
      projectId: "ict-comp",
      storageBucket: "ict-comp.appspot.com",
      messagingSenderId: "151623441013",
      appId: "1:151623441013:web:534610fe20425fd166763c",
      measurementId: "G-H91P9XGM9Z"
    };

    // --- Initialize Firebase ---
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    let attendanceChart;

    // --- Authentication Functions ---
    window.login = async () => {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const button = document.getElementById('loginButton');
      button.textContent = 'Logging In...';
      button.disabled = true;
      try {
        await signInWithEmailAndPassword(auth, email, password);
      } catch (error) {
        alert("Login failed: " + error.message);
        button.textContent = 'Login';
        button.disabled = false;
      }
    };

    window.signup = async () => {
        const email = document.getElementById('signupEmail').value;
        const password = document.getElementById('signupPassword').value;
        const confirmPassword = document.getElementById('signupConfirmPassword').value;
        const button = document.getElementById('signupButton');

        if (password !== confirmPassword) {
            alert("Passwords do not match!");
            return;
        }

        button.textContent = 'Signing Up...';
        button.disabled = true;
        
        try {
            await createUserWithEmailAndPassword(auth, email, password);
            // onAuthStateChanged will handle the redirect to dashboard
        } catch (error) {
            alert("Sign up failed: " + error.message);
            button.textContent = 'Sign Up';
            button.disabled = false;
        }
    };

    window.logout = () => {
      signOut(auth);
    };

    // --- Firestore & Dashboard Functions ---
    window.saveAttendance = async () => {
      const name = document.getElementById("studentName").value;
      const status = document.getElementById("status").value;
      if (!name) {
          alert("Please enter a student name.");
          return;
      }
      const date = new Date().toLocaleDateString('en-GB');
      await addDoc(collection(db, "students"), { name, status, date });
      alert("Attendance record saved.");
      document.getElementById("studentName").value = '';
      loadStudents();
    };

    window.loadStudents = async () => {
      const spinner = document.getElementById("loadingSpinner");
      const tableBody = document.getElementById("studentsTable");
      tableBody.innerHTML = "";
      spinner.classList.remove("hidden");
      
      const q = query(collection(db, "students"), orderBy("name"));
      const querySnapshot = await getDocs(q);
      
      let presentCount = 0;
      let absentCount = 0;
      
      querySnapshot.forEach((doc) => {
        const data = doc.data();
        const rowClass = data.status === "Present" ? 'text-green-700' : 'text-red-700';
        tableBody.innerHTML += `<tr class="border-b"><td class='p-3'>${data.name}</td><td class='p-3 font-semibold ${rowClass}'>${data.status}</td><td class='p-3 text-gray-500'>${data.date}</td></tr>`;
        if (data.status === "Present") presentCount++;
        else absentCount++;
      });
      
      spinner.classList.add("hidden");
      updateChart(presentCount, absentCount);
    };

    function updateChart(present, absent) {
      const ctx = document.getElementById('attendanceChart').getContext('2d');
      if (attendanceChart) {
          attendanceChart.destroy();
      }
      attendanceChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ["Present", "Absent"],
          datasets: [{
            label: "Attendance Count",
            data: [present, absent],
            backgroundColor: ['#4B2067', '#e53e3e'] // Changed green to dark purple
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            title: {
              display: true,
              text: `Total Records: ${present + absent}`
            }
          },
          scales: {
            y: { beginAtZero: true, ticks: { stepSize: 1 } }
          }
        }
      });
    }
    
    // --- Face Recognition Simulation ---
    window.onFaceRecognized = async (studentName) => {
      const date = new Date().toLocaleDateString('en-GB');
      await addDoc(collection(db, "students"), { name: studentName, status: "Present", date });
      console.log(`${studentName} marked as present automatically.`);
      
      const notification = document.getElementById('notification');
      notification.textContent = `Welcome, ${studentName}! Your attendance has been marked.`;
      notification.classList.remove('hidden');
      setTimeout(() => notification.classList.add('hidden'), 4000);
      
      if(auth.currentUser) loadStudents();
    };

    // Remove or comment out the setTimeout simulation
    // setTimeout(() => {
    //   onFaceRecognized("Jane Okoro (Auto-Detected)");
    // }, 5000);

    // Add this after your other dashboard scripts
    document.getElementById('detectFaceBtn').addEventListener('click', function() {
      // Simulate recognizing a saved face (replace with real detection logic if available)
      const recognizedName = "Jane Okoro"; // Replace with actual detected name if using real API
      onFaceRecognized(recognizedName);
    });

    // --- Student Photo Upload & Attendance Records ---
    document.getElementById('studentPhotoForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const name = document.getElementById('studentPhotoName').value.trim();
      const fileInput = document.getElementById('studentPhotoFile');
      const file = fileInput.files[0];
      const previewDiv = document.getElementById('studentPhotoPreview');
      const recordsDiv = document.getElementById('studentAttendanceRecords');

      if (!name || !file) {
        previewDiv.innerHTML = '<span class="text-red-700">Please provide a name and select a photo.</span>';
        recordsDiv.innerHTML = '';
        return;
      }

      // Show preview
      const reader = new FileReader();
      reader.onload = function(evt) {
        previewDiv.innerHTML = `
          <div class="flex flex-col items-center">
            <img src="${evt.target.result}" alt="Student Photo" class="w-32 h-32 object-cover rounded-full border mb-2" />
            <span class="font-semibold">${name}</span>
            <span class="text-green-700">Photo ready to be saved.</span>
          </div>
        `;
      };
      reader.readAsDataURL(file);

      // Fetch and display attendance records for this student
      recordsDiv.innerHTML = '<span class="text-gray-600">Loading attendance records...</span>';
      try {
        const q = query(collection(db, "students"), orderBy("date", "desc"));
        const querySnapshot = await getDocs(q);
        let found = false;
        let tableRows = '';
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          if (data.name && data.name.trim().toLowerCase() === name.toLowerCase()) {
            found = true;
            tableRows += `
              <tr>
                <td class="p-2">${data.date || ''}</td>
                <td class="p-2">${data.status || ''}</td>
              </tr>
            `;
          }
        });
        if (found) {
          recordsDiv.innerHTML = `
            <h4 class="text-lg font-semibold mb-2">Attendance Records for <span class="text-primary">${name}</span></h4>
            <table class="min-w-full bg-white border rounded">
              <thead>
                <tr>
                  <th class="p-2 text-left border-b">Date</th>
                  <th class="p-2 text-left border-b">Status</th>
                </tr>
              </thead>
              <tbody>
                ${tableRows}
              </tbody>
            </table>
          `;
        } else {
          recordsDiv.innerHTML = `<span class="text-red-700">No attendance records found for "${name}".</span>`;
        }
      } catch (err) {
        recordsDiv.innerHTML = `<span class="text-red-700">Error loading records: ${err.message}</span>`;
      }
    });

    // --- UI Control Functions ---
    window.switchAuthTab = (tab) => {
        const loginTab = document.getElementById('loginTab');
        const signupTab = document.getElementById('signupTab');
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');

        if (tab === 'login') {
            loginTab.classList.add('border-primary', 'text-primary');
            loginTab.classList.remove('border-transparent');
            signupTab.classList.remove('border-primary', 'text-primary');
            signupTab.classList.add('border-transparent');
            loginForm.classList.remove('hidden');
            signupForm.classList.add('hidden');
        } else {
            signupTab.classList.add('border-primary', 'text-primary');
            signupTab.classList.remove('border-transparent');
            loginTab.classList.remove('border-primary', 'text-primary');
            loginTab.classList.add('border-transparent');
            signupForm.classList.remove('hidden');
            loginForm.classList.add('hidden');
        }
    };

    // --- Auth State Listener (Controls UI) ---
    onAuthStateChanged(auth, (user) => {
      const publicSections = document.querySelectorAll('.public-section');
      const authSection = document.getElementById('authSection');
      const dashboardSection = document.getElementById('dashboardSection');
      const nav = document.getElementById('navbar');
      const logoutButton = document.getElementById('logoutButton');
      const loginLink = document.getElementById('loginLink');

      if (user) {
        // User is logged in
        authSection.classList.add('hidden');
        dashboardSection.classList.remove('hidden');
        nav.classList.remove('hidden');
        logoutButton.classList.remove('hidden');
        loginLink.classList.add('hidden');
        document.getElementById('welcomeUser').textContent = `Welcome, ${user.email}`;
        loadStudents();
        // Do NOT hide publicSections
      } else {
        // User is logged out
        publicSections.forEach(el => el.classList.remove('hidden'));
        authSection.classList.remove('hidden');
        dashboardSection.classList.add('hidden');
        nav.classList.remove('hidden');
        logoutButton.classList.add('hidden');
        loginLink.classList.remove('hidden');
      }
    });

    document.querySelector('a[href="#hero"]').addEventListener('click', function(e) {
      e.preventDefault();
      document.getElementById('hero').classList.remove('hidden');
      document.getElementById('about').classList.add('hidden');
      document.getElementById('dashboardSection').classList.add('hidden');
    });
    document.querySelector('a[href="#about"]').addEventListener('click', function(e) {
      e.preventDefault();
      document.getElementById('about').classList.remove('hidden');
      document.getElementById('hero').classList.add('hidden');
      document.getElementById('dashboardSection').classList.add('hidden');
    });
  </script>

  <!-- Face API.js will be loaded here -->
  <script defer src="https://cdn.jsdelivr.net/npm/face-api.js"></script>
</head>
<body class="bg-white text-gray-900 font-sans scroll-smooth">

  <!-- Navigation Bar -->
  <nav id="navbar" class="bg-primary text-white p-4 flex justify-between items-center fixed w-full top-0 z-50 shadow-lg hidden">
    <div class="flex gap-6 items-center">
      <img src="file:///C:/Users/p4l_heis/Downloads/images.jpg" alt="RPSS Logo" class="w-12 h-12 object-contain rounded-full" />
      <h1 class="font-bold text-xl">üá≥üá¨ Facial ID Edu NG</h1>
      <a href="#hero" class="hover:underline hidden sm:inline">Home</a>
      <a href="#about" class="hover:underline hidden sm:inline">About</a>
      <a id="loginLink" href="#authSection" class="hover:underline">Login</a>
    </div>
    <div class="flex items-center gap-4">
      <button id="settingsBtn" class="p-2 rounded-full hover:bg-purple-900 transition" title="Settings">
        <!-- Heroicons Cog SVG -->
        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M11.25 2.25c.966 0 1.75.784 1.75 1.75v.5a7.5 7.5 0 013.5 1.01l.35-.35a1.75 1.75 0 112.475 2.475l-.35.35a7.5 7.5 0 011.01 3.5h.5a1.75 1.75 0 110 3.5h-.5a7.5 7.5 0 01-1.01 3.5l.35.35a1.75 1.75 0 11-2.475 2.475l-.35-.35a7.5 7.5 0 01-3.5 1.01v.5a1.75 1.75 0 11-3.5 0v-.5a7.5 7.5 0 01-3.5-1.01l-.35.35a1.75 1.75 0 11-2.475-2.475l.35-.35a7.5 7.5 0 01-1.01-3.5h-.5a1.75 1.75 0 110-3.5h.5a7.5 7.5 0 011.01-3.5l-.35-.35A1.75 1.75 0 115.4 4.16l.35.35a7.5 7.5 0 013.5-1.01v-.5c0-.966.784-1.75 1.75-1.75zM12 15a3 3 0 100-6 3 3 0 000 6z" />
        </svg>
      </button>
      <button id="logoutButton" onclick="logout()" class="bg-white text-primary font-semibold px-4 py-2 rounded-md hover:bg-gray-200 hidden">Logout</button>
    </div>
  </nav>

  <!-- Real-time Notification -->
  <div id="notification" class="hidden fixed top-20 right-5 bg-green-500 text-white py-2 px-4 rounded-lg shadow-xl z-50 animate-fade"></div>

  <!-- Hero Section -->
  <section id="hero" class="public-section text-center py-40 relative text-white" style="background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1523050854058-8df90110c9f1?auto=format&fit=crop&w=1350&q=80') center/cover no-repeat;">
    <div class="container mx-auto px-4">
        <h2 class="text-4xl md:text-6xl font-extrabold mb-4 animate-fade">Redeemers Private Secondary School - On Eagle's Wings</h2>
        <p class="text-xl mb-4 animate-fade">Revolutionizing Education with Facial Recognition</p>
        <p class="text-lg max-w-2xl mx-auto animate-fade">Smart attendance. Real-time data. For every school in Nigeria.</p>
        <a href="#about" class="mt-8 inline-block bg-primary text-white font-bold py-3 px-8 rounded-full text-lg hover:bg-purple-900 transition duration-300">Discover How</a>
    </div>
  </section>

  <!-- About Section -->
  <section id="about" class="public-section py-20 px-6 bg-secondary">
    <div class="max-w-5xl mx-auto">
        <h2 class="text-4xl font-bold mb-12 text-center">Understanding Facial Recognition in Education</h2>
        <div class="space-y-12">
            <div>
              <h3 class="text-2xl font-semibold mb-2">üìñ What is Facial Recognition?</h3>
              <p class="text-lg leading-relaxed">Facial recognition is a biometric technology that identifies individuals by analyzing facial features. It uses mathematical algorithms to recognize patterns like the distance between the eyes, nose shape, and jaw structure.</p>
            </div>
            <div>
              <h3 class="text-2xl font-semibold mb-2">‚öôÔ∏è How Does It Work?</h3>
              <ol class="list-decimal pl-6 text-lg space-y-2">
                <li>A camera captures a student's face.</li>
                <li>The software detects key facial landmarks (e.g. eyes, nose).</li>
                <li>It compares this data to existing face templates in a database.</li>
                <li>If a match is found, the student is marked as present automatically.</li>
              </ol>
            </div>
            <div>
              <h3 class="text-2xl font-semibold mb-2">üéì Benefits for Nigerian Schools</h3>
              <ul class="list-disc pl-6 text-lg space-y-2">
                <li>üìÖ Automated Attendance: Reduces time & human error.</li>
                <li>üîê Increased Security: Prevents impersonation and exam fraud.</li>
                <li>üìà Data Accuracy: Real-time insights into student attendance.</li>
                <li>üìÅ Digital Records: No need for manual roll-calls or registers.</li>
                <li>‚ö° Time Saving: Teachers can focus more on teaching.</li>
              </ul>
            </div>
            <div>
                <h3 class="text-2xl font-semibold mb-2">üõ°Ô∏è Privacy and Ethical Considerations</h3>
                <p class="text-lg leading-relaxed">RPSS ensures all student data is stored securely using Firebase encryption. Parental consent is prioritized, and photos are only used for attendance. No image is shared outside the school system.</p>
            </div>
        </div>
    </div>
  </section>

  <!-- Authentication Section (Login & Sign Up) -->
  <section id="authSection" class="flex justify-center items-center py-20 bg-gray-100">
    <div class="bg-white shadow-xl rounded-lg p-8 max-w-md w-full animate-fade">
      <!-- Tabs -->
      <div class="flex border-b mb-6">
        <button id="loginTab" onclick="switchAuthTab('login')" class="flex-1 py-2 font-semibold text-center border-b-2 border-primary text-primary transition">Login</button>
        <button id="signupTab" onclick="switchAuthTab('signup')" class="flex-1 py-2 font-semibold text-center border-b-2 border-transparent text-gray-500 hover:text-primary transition">Sign Up</button>
      </div>

      <!-- Login Form -->
      <div id="loginForm">
        <h2 class="text-2xl font-bold mb-6 text-center">Admin Login</h2>
        <div class="space-y-4">
            <div>
              <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
              <input id="email" type="email" placeholder="admin@example.com" class="w-full p-3 border rounded-md focus:ring-primary focus:border-primary" />
            </div>
            <div>
              <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
              <input id="password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full p-3 border rounded-md focus:ring-primary focus:border-primary" />
            </div>
            <button id="loginButton" onclick="login()" class="bg-primary text-white w-full py-3 rounded-md hover:bg-purple-900 font-semibold transition duration-300 disabled:bg-gray-400">Login</button>
        </div>
      </div>

      <!-- Sign Up Form (Hidden by default) -->
      <div id="signupForm" class="hidden">
        <h2 class="text-2xl font-bold mb-6 text-center">Create New Account</h2>
        <div class="space-y-4">
            <div>
              <label for="signupEmail" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
              <input id="signupEmail" type="email" placeholder="newuser@example.com" class="w-full p-3 border rounded-md focus:ring-primary focus:border-primary" />
            </div>
            <div>
              <label for="signupPassword" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
              <input id="signupPassword" type="password" placeholder="At least 6 characters" class="w-full p-3 border rounded-md focus:ring-primary focus:border-primary" />
            </div>
            <div>
              <label for="signupConfirmPassword" class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
              <input id="signupConfirmPassword" type="password" placeholder="Re-enter your password" class="w-full p-3 border rounded-md focus:ring-primary focus:border-primary" />
            </div>
            <button id="signupButton" onclick="signup()" class="bg-primary text-white w-full py-3 rounded-md hover:bg-purple-900 font-semibold transition duration-300 disabled:bg-gray-400">Sign Up</button>
        </div>
      </div>
    </div>
  </section>
  
  <!-- Dashboard Section (Hidden by default) -->
  <section id="dashboardSection" class="hidden py-24 px-4 bg-secondary min-h-screen">
    <div class="max-w-7xl mx-auto">
        <h2 id="welcomeUser" class="text-3xl font-bold text-center mb-8">Welcome!</h2>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
          <div class="lg:col-span-1 bg-white p-6 rounded-lg shadow-md">
            <h3 class="text-xl font-semibold mb-4">Manual Attendance Entry</h3>
            <div class="space-y-4">
              <div>
                <label for="studentName" class="block mb-1 font-medium">Student Name</label>
                <input id="studentName" class="w-full p-2 border rounded-md" placeholder="e.g. Chuka Okafor" />
              </div>
              <div>
                <label for="status" class="block mb-1 font-medium">Status</label>
                <select id="status" class="w-full p-2 border rounded-md bg-white">
                  <option value="Present">Present</option>
                  <option value="Absent">Absent</option>
                </select>
              </div>
              <button id="saveAttendanceBtn" class="w-full bg-primary text-white px-4 py-2 rounded-md font-semibold hover:bg-purple-900">Save Record</button>
            </div>
          </div>
          <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md h-96">
            <canvas id="attendanceChart"></canvas>
          </div>
        </div>
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <h3 class="text-xl font-semibold p-4 border-b">Full Attendance Log</h3>
            <div id="loadingSpinner" class="hidden text-center p-4">Loading data...</div>
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="p-3 text-left font-semibold text-gray-600">Name</th>
                            <th class="p-3 text-left font-semibold text-gray-600">Status</th>
                            <th class="p-3 text-left font-semibold text-gray-600">Date</th>
                        </tr>
                    </thead>
                    <tbody id="studentsTable"></tbody>
                </table>
            </div>
        </div>

        <!-- Student Photo Upload Section -->
        <div class="flex flex-col items-center my-8 bg-white p-6 rounded-lg shadow-md max-w-md mx-auto">
          <h3 class="text-xl font-semibold mb-4">Upload & Save Student Picture</h3>
          <form id="studentPhotoForm" class="w-full flex flex-col gap-4">
            <input id="studentPhotoName" type="text" placeholder="Student Name" class="p-2 border rounded-md" required />
            <input id="studentPhotoFile" type="file" accept="image/*" class="p-2 border rounded-md" required />
            <button type="submit" class="bg-primary text-white px-4 py-2 rounded-md font-semibold hover:bg-purple-900 transition duration-300">Upload Photo</button>
          </form>
          <div id="studentPhotoPreview" class="mt-4"></div>
        </div>
        <div id="studentAttendanceRecords" class="mt-6 w-full"></div>

        <!-- Detect Face Feature -->
        <div class="flex justify-center mb-6">
          <button id="detectFaceBtn" class="bg-primary text-white px-6 py-2 rounded-md font-semibold hover:bg-purple-900 transition duration-300">
            Detect Face
          </button>
        </div>
        <div class="flex flex-col items-center my-6">
          <video id="videoInput" width="320" height="240" autoplay muted class="rounded shadow mb-2"></video>
          <div id="faceResult" class="text-lg font-semibold text-primary"></div>
        </div>
    </div>
  </section>

  <!-- Settings Modal -->
  <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-lg p-8 relative animate-fade">
      <button onclick="closeSettings()" class="absolute top-3 right-3 text-gray-400 hover:text-primary text-2xl">&times;</button>
      <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M11.25 2.25c.966 0 1.75.784 1.75 1.75v.5a7.5 7.5 0 013.5 1.01l.35-.35a1.75 1.75 0 112.475 2.475l-.35.35a7.5 7.5 0 011.01 3.5h.5a1.75 1.75 0 110 3.5h-.5a7.5 7.5 0 01-1.01 3.5l.35.35a1.75 1.75 0 11-2.475 2.475l-.35-.35a7.5 7.5 0 01-3.5 1.01v.5a1.75 1.75 0 11-3.5 0v-.5a7.5 7.5 0 01-3.5-1.01l-.35.35a1.75 1.75 0 11-2.475-2.475l.35-.35a7.5 7.5 0 01-1.01-3.5h-.5a1.75 1.75 0 110-3.5h.5a7.5 7.5 0 011.01-3.5l-.35-.35A1.75 1.75 0 115.4 4.16l.35.35a7.5 7.5 0 013.5-1.01v-.5c0-.966.784-1.75 1.75-1.75zM12 15a3 3 0 100-6 3 3 0 000 6z" />
        </svg>
        Settings
      </h2>
      <div class="space-y-4">
        <div>
          <label for="schoolName" class="block text-sm font-medium text-gray-700 mb-1">School Name</label>
          <input id="schoolName" type="text" class="w-full p-3 border rounded-md focus:ring-primary focus:border-primary" />
        </div>
        <div>
          <label for="adminEmail" class="block text-sm font-medium text-gray-700 mb-1">Admin Email</label>
          <input id="adminEmail" type="email" class="w-full p-3 border rounded-md focus:ring-primary focus:border-primary" />
        </div>
        <div>
          <label for="adminPassword" class="block text-sm font-medium text-gray-700 mb-1">Admin Password</label>
          <input id="adminPassword" type="password" class="w-full p-3 border rounded-md focus:ring-primary focus:border-primary" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">USB Device Connection</label>
          <div class="flex gap-2">
            <button id="usbConnectBtn" type="button" class="bg-primary text-white px-4 py-2 rounded-md font-semibold hover:bg-purple-900 transition duration-300">
              Connect USB Device
            </button>
            <span id="usbStatus" class="text-sm text-gray-600 self-center"></span>
          </div>
        </div>
        <button id="saveSettingsButton" class="w-full bg-primary text-white px-4 py-2 rounded-md font-semibold hover:bg-purple-900 transition duration-300">Save Settings</button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-dark text-white text-center py-6">
    <p>¬© <span id="year"></span> Facial ID Edu NG ‚Äî Built for RPSS Nigeria</p>
  </footer>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();
  </script>

  <script type="module">
    // Make Detect Face button actually use webcam and detect a face
    document.getElementById('detectFaceBtn').addEventListener('click', async function() {
      const video = document.getElementById('videoInput');
      const resultDiv = document.getElementById('faceResult');
      if (!video || !resultDiv) {
        alert("Video or result area not found in the DOM!");
        return;
      }
      resultDiv.textContent = "Loading models...";

      try {
        await faceapi.nets.tinyFaceDetector.loadFromUri('https://justadudewhohacks.github.io/face-api.js/models');
        resultDiv.textContent = "Models loaded. Starting camera...";
      } catch (e) {
        resultDiv.textContent = "Failed to load models.";
        console.error(e);
        return;
      }

      navigator.mediaDevices.getUserMedia({ video: {} })
        .then(stream => {
          video.srcObject = stream;
          video.play();
          resultDiv.textContent = "Detecting face...";
          detectFace();
        })
        .catch(err => {
          resultDiv.textContent = "Camera access denied.";
          console.error(err);
        });

      async function detectFace() {
        try {
          const detection = await faceapi.detectSingleFace(video, new faceapi.TinyFaceDetectorOptions());
          if (detection) {
            resultDiv.textContent = "Face Detected!";
            // onFaceRecognized("Demo Student"); // Uncomment if you want to mark attendance
            video.srcObject.getTracks().forEach(track => track.stop());
          } else {
            resultDiv.textContent = "No face detected. Please look at the camera.";
            setTimeout(detectFace, 500);
          }
        } catch (e) {
          resultDiv.textContent = "Detection error: " + e.message;
          console.error(e);
        }
      }
    });
  </script>
</body>
</html>